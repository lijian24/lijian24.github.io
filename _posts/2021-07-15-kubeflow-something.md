---
layout: post
title: 基于kubeflow，构建整套模型工厂的猜想
categories: [k8s]
tags: [k8s]
description: 纯粹的口嗨之见，错误之处欢迎指正。
---

写在前面：
1. 笔记更多为了人来阅读，尽可能清楚简洁地表达观点。
2. 本文纯粹的口嗨，不正确之处欢迎指正。

## 背景
1. 手边有多个模型，模型依赖的框架不同，版本不同，想要统一对模型做管理。
2. 对于一个模型，常见的依赖包括：版本控制、预处理、后处理、配置管理、依赖词典管理。

## 初步调研
1. 公有云：可以完美支持上面的管理需求，但是可惜手边的模型一般处于局域网中，天然不太可行。
2. 自研-系统：各大厂都有一些方案，大同小异，可以完美满足上述的要求，但是成本极高。[weibo](https://www.infoq.cn/article/dNJIZeOiADSk1Jfz8WIH)、[alibaba](https://aijishu.com/a/1060000000113402)、[netease](https://www.freebuf.com/articles/network/222893.html)。
3. 自研-服务：一般是个人用来部署预测服务。[blog](https://blog.51cto.com/u_15127630/2771767)

## 方案评估
1. 公有云无私有化部署，或私有化部署成本较高，pass。
2. 自研-服务的模式虽然成本较低，但是整体方案比较局限，后续扩容或者支持其他服务都需要直接在物理机上操作，增加运维成本，pass。
3. 自研-系统的模式虽然从效果上看的话，应该会比上面两者更好，但是在成本上会增加非常多，pass。
4. 反思：从上面看的话，好像陷入了一条死胡同。再扫一遍上面的几种方案，突然发现[网易](https://www.freebuf.com/articles/network/222893.html)的方案好像并没有特别高的成本，而且功能丰富程度也相对适中。并且部署在k8s上的环境理论上为后续的升级操作也预留了比较丰富的可能性。

## 脑中的设想——资源分析
1. 物理资源：磁盘、内存、CPU、GPU
2. 逻辑资源/虚拟化技术：K8S管理
3. 系统流程模式：模型、版本、预处理、后处理、配置、词典
4. 系统对外逻辑：训练、测试

## 脑中的设想——实现方案
1. 物理资源：真实物理机 or 虚拟机 or 其他机器资源
2. 逻辑资源：K8S
3. 虚拟环境：docker，需要管理常见的环境，比如模型框架，框架版本等
4. 模型训练、测试逻辑：基于统一的输入输出服务接口，在docker环境下完成模型的finetune
5. 其他：模型文件管理，配置文件管理，词典文件管理

## 脑中的设想——简化方案
1. kubeflow是不是可以简化当前设想的模型训练、测试逻辑
2. kubeflow中的pipeline模块是不是可以帮助我们管理算法内部的调用逻辑
3. 逻辑上预处理、后处理是无关上下文的，是不是可以提取出来，作为kubeflow的一种节点，从而降低算法RD的重复工作

## 后记
[TODO] 有时间一定要研究研究啊，拖延症又犯了。